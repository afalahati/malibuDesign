{% extends "base.html" %}
{% block title %}Malibu General{% endblock %}
{% block content %}

<section id="slideshow" class="slideshow-container">
  <div  class="slideshow">
  {% for slide in slides %}
    <div class="slide{% if forloop.first %} active{% endif %}" style="background-image: url('{{ slide.image.url }}')">
      <div class="slide-description">{{ slide.description }}</div>
    </div>
  {% empty %}
    <p style="color:white; text-align:center; padding-top: 50vh;">No slides available.</p>
  {% endfor %}

  <button class="nav-btn prev" id="prevBtn">&#10094;</button>
  <button class="nav-btn next" id="nextBtn">&#10095;</button>
</div>
</section>

<section id="projects">
  <br><br>
  <h2 ></h2>
  <h2 >Projects</h2>
  <h2 ></h2>
  <div style="display:grid; grid-template-columns: repeat(auto-fit,minmax(280px,1fr)); gap: 1.5rem;">
    {% for project in projects %}
      <div class="project-card" 
        data-project-id="{{ project.id }}"
        data-project-title="{{ project.title|escapejs }}"
        data-project-images='[{% for img in project.images.all %}"{{ img.image.url }}"{% if not forloop.last %},{% endif %}{% endfor %}]'
        data-project-descriptions='[{% for img in project.images.all %}"{{ img.caption|default:"" |escapejs }}"{% if not forloop.last %},{% endif %}{% endfor %}]'
      >
        {% if project.images.all %}
          {% with main_image=project.images.all.0 %}
          <img class="project-img" src="{{ main_image.image.url }}" alt="{{ project.title }}" style="
            width: 100%;
            height: 220px;
            object-fit: cover;
            display: block;
            border-bottom: 1px solid #e5e7eb;
          " />
          {% endwith %}
        {% else %}
          <div style="width: 100%; height: 220px; background: #f9fafb; display: flex; align-items: center; justify-content: center; color:#9ca3af; font-size:1rem;">
            بدون تصویر
          </div>
        {% endif %}
        <div style="padding: 1rem;">
          <h3 style="margin: 0 0 0.75rem; color:#111827; font-weight: 600; font-size: 1.25rem;">{{ project.title }}</h3>
          <p style="font-size: 0.95rem; color: #6b7280;">{{ project.description|truncatewords:25 }}</p>
        </div>
      </div>
    {% endfor %}
  </div>

  <!-- مودال با قابلیت اسلایدشو -->
  <div id="projectModal" >
    <div id="projectModal1">
      <button id="modalCloseBtn" aria-label="Close Modal" >
        &times;
      </button>
      <h2 id="modalTitle"></h2>
      <div id="slideshowContainer" >
        <!-- اسلایدها به صورت داینامیک اضافه می‌شوند -->
      </div>
      <div id="slideDescription"></div>
      <div id="slideDescription1">
        <button id="prevSlideBtn" >Pre</button>
        <button id="nextSlideBtn" >Next</button>
      </div>
    </div>
  </div>
</section>
<section id="blog">
  <h2>Blog</h2>
  <div class="article-container">
  {% for post in blog_posts %}
        <div class="article">
            <div class="article-content">
                <h3>{{ post.title }}</h3>
                <p>{{ post.content|safe|truncatewords:4 }}</p>
                <a href="{% url 'blog_detail' post.id %}" class="read-more" aria-label="Read more about {{ post.title }}">Read More →</a>
                <div class="meta-info">
                    <span class="author">Author: {{post.author}}</span>
                    <span>Date: {{post.created_at}}</span>
                    <span>{{post.review}}</span>
                </div>
            </div>
            <div class="article-image">
                <img src="{{ post.image.url }}" alt="Article Image 1">
            </div>
        </div>
{% endfor %}
        
    </div>
</section>

<section id="about" class="about-us" >
  <p>
    M E H R D A D S A H A F I<br>
B I O G R A P H Y<br>
Mehrdad Sahafi is the Principal of Malibu Design Associates, Inc., Malibu General Contractors, Inc. and Malibu Land Company LLC. He has been successfully designing and Developing Estates for over 37 YEARS exclusively in Malibu. Mr. Sahafi Develops Luxury Estates for his own family and for many of the wealthiest people in the world.
Born in 1959, Mr. Sahafi finished his academic training and education in the discipline of Architecture in the year of 1985. He received his Bachelor of Professional Architecture (BARCH) with Honors from The California State University Pomona (CALPOLY POMONA). During his academic years he participated in numerous National and International Architectural Design Competitions and received numerous design and scholarship awards.
After graduating and after few years of Architectural Field experience, he went on to establish Malibu Design Associates, Inc. in the year of 1988 in Malibu. He gradually became experienced in his field and used his expertise and creativity in designing Single family Estates in the tough yet beautiful environ of Malibu. He gradually started landing big contracts for complicated and large estates due to the demand that was associated with the Malibu and its attraction to the celebrities and wealthy clientele.
In the year 1995 he established Malibu General Contractors, Inc. He did this primarily because he did not see; contractors who build his designs quite carry on his vision of creating flawless masterpieces. He was adamant to have aesthetic control over the projects he designed from the start through completion. Establishing Malibu General Contractors Inc. was his answer to this dilemma.
Since the inception of Malibu General Contractors, Inc. and in the past 30 years
Mr. Sahafi’s Designed Estates and developments have been winning design acclaims and gracing the covers of Magazines. His unique brand of design, attention to detail and unconventional approach to design makes his Estates one of a kind and talk of the town. Any project associated with Mr. Sahafi and his three reputable companies is bound to demand a much higher premium just because of that fact.
Mr. Sahafi has left THIRTY SEVEN years of flawless and impeccable tract record by producing architectural masterpieces and construction projects exclusively in Malibu. His great business association with Malibu Chamber of Commerce, Better Business Bureau, (Oldest Member by membership), A+ rated from Western Regional Master Builders Association, Excellent rated at Dunn & Bradstreet and Contractors State Licensing Board are further testimony to his success. In the year 2003 he was chosen to be, “2003 BUSINESSMAN OF THE YEAR” from Malibu by the “Business Advisory Council “of the United State Congress.
</p>
</section>
<section id="employees" >
  <div style="max-width:1200px; margin:auto; padding:0 1.25rem;">
    <h2>
      Our Team
    </h2>
    <div style="
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 2.5rem;
      justify-items: center;
    ">
      {% for employee in employees %}
      <div class="employee-card"
      tabindex="0"
      role="button"
      aria-haspopup="dialog"
      aria-controls="employeeModal{{ employee.id }}"
      aria-label="View resume of {{ employee.name }}"
      data-employee-id="{{ employee.id }}"
      >
        <img src="{{ employee.photo.url }}" alt="{{ employee.name }}" />
        <h3 >{{ employee.name }}</h3>
      </div>
      {% endfor %}
    </div>
  </div>
  {% for employee in employees %}
  <div id="employeeModal{{ employee.id }}" class="employee-modal" 
  role="dialog" aria-modal="true" aria-labelledby="employeeName{{ employee.id }}" tabindex="-1"
  >
    <div style="
      background: #ffffff;
      border-radius: 0.75rem;
      max-width: 600px;
      margin: auto;
      padding: 2rem;
      box-shadow: 0 10px 24px rgba(0,0,0,0.2);
      position: relative;
    ">
      <button aria-label="Close resume of {{ employee.name }}" class="close-btn" >&times;</button>
      <h2 id="employeeName{{ employee.id }}" >{{ employee.name }}</h2>
      <div style="
        color: #6b7280;
        font-size: 1rem;
        line-height: 1.6;
        white-space: pre-wrap;
        font-family: 'Inter', sans-serif;
      ">
        {{ employee.resume }}
      </div>
    </div>
  </div>
  {% endfor %}
</section>
{% endblock %}